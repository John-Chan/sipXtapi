#!/bin/bash
#
# Copyright (C) 2004 SIPfoundry Inc.
# Licensed by SIPfoundry under the LGPL license.
#
# Copyright (C) 2004 Pingtel Corp.
# Licensed to SIPfoundry under a Contributor Agreement.

Action=RUN
Status=0
Args=""

while [ $# -ne 0 ]
do
    case ${1} in
        --configtest)
            Action=CONFIGTEST
            ;;

        *)
            Args="$Args $1"
            ;;
    esac           

    shift # always consume 1
done

case ${Action} in
   RUN)
     echo $$ > @SIPX_RUNDIR@/watchdog.pid
     exec @bindir@/watchdog $Args
     ;;

   CONFIGTEST)
        @SIPX_BINDIR@/sipx-validate-xml @SIPX_CONFDIR@/WatchDog.xml
        Status=$(($Status+$?))
        @SIPX_BINDIR@/sipx-validate-xml @SIPX_CONFDIR@/ProcessDefinitions.xml
        Status=$(($Status+$?))
        for procspec in @SIPX_CONFDIR@/process.d/*.process.xml
        do
          @SIPX_BINDIR@/sipx-validate-xml $procspec
          Status=$(($Status+$?))
        done
        ;;
esac

exit $Status
