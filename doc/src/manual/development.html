<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

 <head>
  <title>sipXconfig Development</title>
  <link rel="stylesheet" type="text/css" href="manual.css"/>

</head>
<body id="development">

<h1>Development</h1>


<h2>Remote debugging of sipXconfig components</h2>

<p>It is possible to configure sipXconfig Java applications for remote debugging (JDWP). "Remote" in this context means that Java 
debugger attaches to process started by sipX watchdog, and not by the debugger.
Debugger can actually run on the same machine as sipX services.
</p>
<p>
While it's not strictly required, the first step should be building Java code with debug information:
</p>
<pre>
mkdir debug
cd debug
JAVAC_DEBUG=on JAVAC_OPTIMIZED=off ../configure
make
make install
</pre>

To launch the program in the debugging mode you need to specify debug mode 
and communication port for the debugger. Each server's startup script lets
you pass the necessary information through environment variables.

<pre>
  export JAVA_DEBUG_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5498"
</pre>

<p>
In the example above we use port 5498. 
You can use other ports as long as the number you pass to Java 
application is the same as the number you pass to the debugger. 
</p>
<p>
Depending on which component you want to debug you will need to set
<strong>only one</strong> of the following environment variables.
</p>
<pre>
  export PROFILEGENERATOR_OPTS=${JAVA_DEBUG_OPTS}
or  
  export PROFILEPUBLISHER_OPTS=${JAVA_DEBUG_OPTS}
or  
  export PROFILEWRITER_OPTS=${JAVA_DEBUG_OPTS}
</pre>
	

<p>
Once the process is running you can attach your favorite debugger. If you use 
jdb, your command line should look like that:
</p>

<pre>$JAVA_HOME/bin/jdb -connect com.sun.jdi.SocketAttach:hostname=localhost,port=5498</pre>
<p>
Other debuggers and IDEs are also supported. Information on how to
 configure your favorite IDE can be usually 
found under <em>Remote Java Debugging</em> in user manual.
</p>

<h2>Building using Ant</h2>

<p>
Only a small subset of build targets is available through make build system. It is possible however
to use Ant directly when developing sipXconfig.
Our build.xml files retrieve most of the required properties from config.properties file generated by autoreconf.
The only property that needs to be passed explicitly is top.build.dir specifying the location of your build directory.
Since Ant needs to load optional jars on startup one also has to specify -lib option.
<br/>
The full command line looks something like that:
</p>

<pre>
ant -Dtop.build.dir=/path/to/build/directory -lib /path/to/sipXconfig/lib my-target-name
</pre>

<p>
Please note that Ant needs to be executed from the source directory (directory in which 
build.xml file is located) and not from you build directory.
</p>

<p>
If you happen to use ant builds a lot it may be useful to set ANT_ARGS environment variable instead of 
typing the full command line every time. ANT_ARGS is a standard ant variable that allows passing extra 
command options to ant.
</p>

<pre>
export ANT_ARGS="-Dtop.build.dir=/path/to/build/directory -lib /path/to/sipXconfig/lib my-target-name"
</pre>

If ANT_ARGS is set properly you can call build targets just by typing <code>ant target</code>. For example 
you can list all possible targets by typing:

<pre>
    ant -p
</pre>    

    
<h2>Checking code coverage using Clover</h2>

<p>sipXconfig build files are prepared for Clover instrumentation. Clover instrumentation and 
reports assist in assessing effectiveness of unit tests. We will attempt to achieve 80% of coverage
for newly written code.</p>

<p>
Download <a href="http://www.cenqua.com/clover/">Clover</a>, unzip it to local directory and set 
<code>CLOVER_HOME</code> environment variable. Reconfigure your build directory (run configure script) 
and verify that Clover has been installed properly check if <code>clover.jar</code> property is set 
in config.properties file.
</p>
<pre>
  grep clover.jar config.properties
</pre>

<p>
In order to instrument the code on has to run ant directly (and not through the make system). You have to pass 
the location of clover.jar to ant, for example by appending it to ANT_ARGS variable.
</p>

<pre>
    export ANT_ARGS="-lib $CLOVER_HOME/lib/clover.jar $ANT_ARGS"
</pre>

<p>
Below you can find the typical scenario:
</p>

Clean and rebuild your sources with Clover instrumentation:
<pre>
    ant clean with.clover default 
</pre>


Run unit tests
<pre>
    ant test
</pre>

Run clover GUI to check code coverage
<pre>
    ant clover.viewer
</pre>

Alternatively generate HTML report:

<pre>
    ant clover.report
    htmlview /path/to/build/directory/clover/html/index.html
</pre>

    
<span id="lastmodified">
<!-- hhmts start -->
Last modified: Nov 23, 2004
<!-- hhmts end -->
</span>

</body>
</html>
