<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

 <head>
  <title>sipXconfig Installation</title>
  <link rel="stylesheet" type="text/css" href="manual.css"/>

</head>
<body id="installation">

<pre class="hide">
<!-- lynx ignores CSS and shows this -->
This file was generated using the following command.  If you are
already looking at this from a web browser, then please ignore this
message.

  cd doc;ant text-doc

----------------------------------------------------------
</pre>

<h1>Installation</h1>

<ol>
  <li><a href="#rh">For Redhat Users</a>
     <ol>
      <li><a href="#rh-system">System Installation</a></li>
      <li><a href="#rh-dep">Installing dependencies with up2date</a></li>
      <li><a href="#rh-jdk">Installing Java RPM</a></li>
      <li><a href="#rh-sipx">Installing RPMs from SIPfoundry</a></li>
      </ol>
   </li>

  <li><a href="#src">Installing From Source and Non-Redhat Users</a>
       <ol>
	 <li><a href="#src-dep">Dependencies</a></li>
	 <li><a href="#src-env">Environment Variables</a></li>
	 <li><a href="#src-compile">Compile and Installation</a></li>    
	 <li><a href="#src-jboss">JBOSS Setup</a></li>
	 <li><a href="#src-db">Postgres Database Setup</a></li>
	</ol>
    </li>

    <li><a href="#optional">Optional Setup</a>
	<ol>
            <li><a href="#tftp">TFTP Setup for Cisco 79xx</a></li>
            <li><a href="#neoconf">Phone Plugin Development</a></li>
	 </ol>
    </li>

    <li><a href="#security">Security</a></li>
    <li><a href="#run">Running</a>
      <ol>
         <li><a href="#run-sipx">Running with other sipX servers</a></li>
         <li><a href="#run-alone">Running Standalone</a></li>
      </ol>
  </li>
      
  <li><a href="#windows">Windows</a></li>
      
</ol>

<h2><a name="rh">For Redhat Users</a></h2>

<p>These instructions apply to Enterprise and Fedora systems unless
explicitly noted</p>

<h3><a name="rh-system">System Installation</a></h3>
<ol>
  <li>Install Redhat from CDs.  You can select any set of packages
  including the minimum set of packages labeled "router configuration"
  in the Redhat installer process</li>

  <li>When prompted for firewall support, select "no firewall support" or
  open up the following ports in your iptables: 80, 8080, 8090, 8091,
  5060 and 5090</li>
      
</ol>

<h3><a name="rh-dep">Installing dependencies with up2date</a></h3>

<p>Fedora users may experience periodic connection errors using using
<code>up2date</code> but usually if you're persistent you can get through
executing <code>up2date</code> repeatedly. If you do not use
<code>up2date</code>, I recommend installing Postgres and apache while
installing your system, or use the Redhat package manager to install
those RPMs for you.</p>

<ul>
  
  <li>Run <code>up2date</code> for the first time and follow
instructions to setup properly <code>up2date</code> operation.</li>

  <li>Run <code>up2date -u</code> to make your system is up to date.</li>

  <li>Run <code>up2date</code> on the following packages:

<dl>
   <dt>Postgres</dt>

   <dd><code>up2date rh-postgresql-server</code> <strong>*Enterprise
Users Only</strong></dd>
       
   <dd><code>up2date postgresql-server</code> <strong>*Fedora Users
Only</strong></dd>

   <dt>Apache 2 webserver</dt>
   <dd><code>up2date httpd</code></dd>

</dl>
      </li>
</ul>


<h3><a name="rh-jdk">Installing Java RPM</a></h3>

<ul>
  <li>j2sdk 1.4 or greater available by opening your webbrowser to this URL:<br/>
    <a href="http://java.sun.com/j2se/1.4.2/download.html">http://java.sun.com/j2se/1.4.2/download.html</a>
  </li>
</ul>

<h3><a name="rh-sipx">Installing RPMs dependencies from SIPfoundry</a></h3>
<ul>
    <li>cgicc</li>
    <li>mod_cplusplus</li>
    <li>w3c-libwww</li>
    <li>xerces-c</li>
</ul>

<p>Download and install the following RPMS from <a href="http://www.sipfoundry.org/pub/sipX/depends/FC/2/SIPfoundry">http://www.sipfoundry.org/pub/sipX/depends/FC/2/SIPfoundry</a>.</p>

<h3><a name="rh-sipx">Installing sipX RPMs from SIPfoundry</a></h3>

<p>Download and install the following RPMs from <a href="http://www.sipfoundry.org/pub/sipX/FC/2/">http://www.sipfoundry.org/pub/sipX/FC/2/</a></p>
<ul>
  <li>sipx-jboss-2.4.10-2.noarch.rpm</li>
  <li>sipxportlib</li>
  <li>sipxtacklib</li>
  <li>sipxcommserverlib</li>
  <li>sipxconfig</li>
  <li>sipxproxy</li>
  <li>sipxregistry</li>
  <li>sipxpublisher</li>
  <li>sipxvxml</li>
  <li>sipxpbx</li>
</ul>


<h2><a name="src">Installing From Source and Non-Redhat Users</a></h2>

<p>Install the following software packages. Follow the installation
instructions for your OS.  If there is any special installation
instructions, they will be noted.</p>

<h3><a name="src-dep">Dependencies</a></h3>

<dl>

  <dt>sipXportLib (same version sipXconfig)</dt>
  <dd><a href="http://www.sipfoundry.org/sipXportLib">http://www.sipfoundry.org/sipXportLib</a></dd>

  <dt>sipXtackLib (same version sipXconfig)</dt>
  <dd><a href="http://www.sipfoundry.org/sipXtack">http://www.sipfoundry.org/sipXtack</a></dd>

  <dt>sipXcommserverLib (same version sipXconfig)</dt>
  <dd><a href="http://www.sipfoundry.org/sipXcommserverLib">http://www.sipfoundry.org/sipXcommserverLib</a></dd>

  <dt>sipXpbx (same version sipXconfig)</dt>
  <dd><a href="http://www.sipfoundry.org/sipXpbx">http://www.sipfoundry.org/sipXpbx</a></dd>

  <dt>Java SDK 1.4 (tested w/1.4.2.03)</dt>
  <dd><a href="http://java.sun.com">http://java.sun.com</a></dd>

  <dt>postgres 7.3 (tested with 7.3.4)</dt>
  <dd><a href="http://www.postgresql.org/">http://www.postgresql.org/</a></dd>

  <dt>JBoss 2.4.4 with Tomcat 4.0.1 (exactly this version!)</dt>
  <dd><a href="http://prdownloads.sourceforge.net/jboss/JBoss-2.4.4_Tomcat-4.0.1.zip">http://prdownloads.sourceforge.net/jboss/JBoss-2.4.4_Tomcat-4.0.1.zip</a></dd>

  <dt>Spring Framework 1.1.2 with dependencies</dt>
  <dd><a href="http://www.springframework.org/download.html">http://www.springframework.org/download.html</a></dd>

  <dt>Ant 1.6 (tested with 1.6.1)</dt>
  <dd><a href="http://ant.apache.org/">http://ant.apache.org/</a></dd>
      
</dl>

<h3><a name="src-env">Environment Variables</a></h3>

<p>Set the following environment variables:</p>

<dl>
  <dt>JAVA_HOME</dt>

  <dd>to where you installed java. This setting is just used to
compile.  After installation the <code>sipx-config --jdk</code> is used
      to find java dynamically.  That means you can upgrade your java
and not break your installation
      
  <pre>
       Example: 
           export JAVA_HOME=/usr/java/j2sdk1.4.2_03
   </pre>
  </dd>

  <dt>ANT_HOME</dt>
  <dd>where you unzipped (e.g. installed) ant
  <pre>
       Example: 
            export ANT_HOME=/opt/apache-ant-1.6.2
   </pre>
   </dd>

 <dt>JBOSS_HOME</dt>
 <dd>where you unzipped JBoss
 <pre>
       Example: 
          export JBOSS_HOME=/opt/JBoss-2.4.10_Tomcat-4.0.6
  </pre>
  </dd>

 <dt>SPRING_HOME</dt>
 <dd>where you unzipped Spring Framwork
 <pre>
       Example: 
          export SPRING_HOME=/opt/springframework-1.1.2
  </pre>
  </dd>
</dl>

<h3><a name="src-compile">Compiling and Installation</a></h3>

<p>If you've obtained your source from subversion, and not from a tar
file, run this command:</p>
<pre>
  autoreconf -if
</pre>


<p>Now compile and install sipXconfig by running this command:</p>
<pre>
     ./configure
     make
     make install
</pre>


<h3><a name="src-jboss">JBOSS Setup</a></h3>

<p>After unzipping JBoss</p>

<ol>
  <li>run this patch on it
<pre>
      patch -d ${JBOSS_HOME} -p1 &lt; sipx-jboss-configure.patch
</pre>
  </li>

  <li>be sure user running sipxpbx (most cases sipxchange) has full r/w
     access to all files and directories in <code>${JBOSS_HOME}</code></li>
</ol>
<p>
You also need to patch Jasper class loader in Tomcat servlet container that is bundled with this version of JBoss
</p>
<ol>
<li>Checkout Tomcat 4.0.1 source
<pre>
      export CVSROOT=:pserver:anoncvs@cvs.apache.org:/home/cvspublic
      cvs login [anoncvs]
      cvs co -r tomcat_401 jakarta-tomcat-4.0
</pre></li>
<li>Patch sources
<pre>
      patch -d /path/to/tomcat -p0 &lt; meta/tomcat_401.diff
</pre></li>

<li>Prepare Tomcat build environment.<br/>
BUILDING.txt file contains detailed description of the entire building process. Since we 
just need to build jasper module we can use simplified approach.<br/>
Create a <code>build.properties</code> file by copying a sample properties file:
<pre>
      cd /path/to/tomcat
      cp build.properties.sample build.properties
</pre>
and modify <code>servlet.lib</code> property in a newly created file to point to your Tomcat lib directory
<pre>
      servlet.lib=${JBOSS_HOME}/catalina/common/lib
</pre></li>

<li>Verify that you have set the path correctly:
<pre>
      cd /path/to/tomcat
      ant detect | grep servlet.jar
</pre>
You should see:
<pre>
      [echo] servlet.jar.present=true
</pre></li>

<li>Compile Jasper
<pre>
      cd /path/to/tomcat/jasper
      ant
</pre>
Build creates 2 jar file. Only <code>jasper-compiler.jar</code> has to be copied to Tomcat installation.
<pre>
      cp /path/to/tomcat/build/lib/jasper-compiler.jar ${JBOSS_HOME}/catalina/lib/jasper-compiler.jar
</pre></li>
</ol>

<h3><a name="src-db">Postgresql Database Setup</a></h3>

<p>Postgres needs to always be running on your system. If you've
installed sipXconfig from RPM, you shouldn't have to do this.</p>

<p>To start Postgres on Redhat 9 or Fedora systems run this command.</p>
  <pre>
      service postgresql start 
  </pre>


<p>To start Postgres on Enterprise 3 systems run this command.</p>
  <pre>
      service rhdb start 
  </pre>
  
<p>To start Postgres on Debian, and perhaps other linux distributions, if you 
	don't already have a /etc/init.d/postgresql you may need to get the example 
	from the contrib directory in the postgres distibution: </p>
<pre>
	cp contrib/start-scripts/linux /etc/init.d/postgresql
</pre>

<p>It's recommended you should have Postgres start automatically when your machine
restarts (usually in runlevels 3 and 5).</p>

<p>Fedora and Redhat 9 users should run this command:</p>

<pre>
      chkconfig postgresql on
</pre>


<p>Redhat Enterprise 3 users should run this command:</p>

<pre>
      chkconfig rhdb on
</pre>


<p>Edit Postgres config files to work. This will open up TCP connections and
allow localhost to connect to Postgres</p>

<pre>
     /usr/local/sipx/bin/sipxdbmgr --setup
     /usr/local/sipx/bin/sipxdbmgr --create PDS
     /usr/local/sipx/bin/sipxdbmgr --create SDS
</pre>

<h2><a name="security">Security</a></h2>

<p>Set up an SSL key using the instructions in
sipXcommserverLib/doc/INSTALL.ssl or
/usr/share/doc/sipxcommserverlib-<em>version</em>/INSTALL.ssl.</p>


<h2><a name="optional">Optional Setup</a></h2>

<h3><a name="tftp">TFTP Setup for Cisco 79xx phones</a></h3>

<p>Most Cisco phones in the 79xx series use a tftp server to serve
phone configuration information and firmware upgrades.  You must
install a tftp server and map the tftp root directory to:
<code>var/sipxdata/configserver/phone/profile/tftproot</code>.
Consult phone vendor documentation for recommended TFTP servers but
below is a set of known tftp server setups that work.</p>

<h4>On Fedora or Red Hat Enterprise</h4>
<p>Run the following commands</p>
<pre>
  up2date tftp-server
  ${EDITOR} /etc/xinetd.d/tftp
</pre>
<p>make the following <strong>edits</strong>, if you've installed via
RPM, then <code>{where you installed sipXconfig}</code> is empty:</p>
<pre>
   disable  = no
   server_args  = -s <em>{where you installed sipXconfig}</em>/var/sipxdata/configserver/phone/profile/tftproot
</pre>

<p>Run the following commands for your edits to take affect</p>
<pre>
  # ensure tftp server is not already running
  ps aux | grep tftp
 
  # if so, stop it
  kill -15 {tftp pid}

  # restart xinit.d that in turn will start tftp on demand
  service xinet.d restart
</pre>


<h4>On Gentoo</h4>
<p>Run the following commands</p>
<pre>
  emerge net-misc/tftp-hpa
  ${EDITOR} /etc/conf.d/in.tftpd
</pre>

<p>make the following edits</p>
<pre>
  INTFTPD_PATH="<em>{where you installed sipXconfig}</em>/var/sipxdata/configserver/phone/profile/tftproot"
</pre>

<p>then run the following command</p>
<pre>
  /etc/init.d/in.tftp start
</pre>

<h3><a name="neoconf">Phone Plugin Development</a></h3>

<p>New module for developing support for new phone devices. Although this 
	module is intended to be a foundation for a new system architecture for 
	entire project. See <a href="neoconf.html">Neoconf</a> for installation 
	procedure and necessary software dependencies.</p>

<h2><a name="run">Running</a></h2>

<h3><a name="run-sipx">Running with other sipX servers</a></h3>

<p>This is the normal configuration.  It's where all the sipx servers
like the proxy, status server, mediaserver, etc. are running on the
same machine. In this case you will want to follow the instructions in
the sipXpbx project for starting the <code>sipxpbx</code> service.
This will control the starting and stopping of the necessary
components of the configuration system.  The sipXproxy will direct SIP
messages to the Profile Publisher automatically.  If you are using
another SIP proxy other than the sipXproxy, or running the sipXproxy on
another machine, follow next section "Running Standalone".</p>


<h3><a name="run-alone">Running Standalone</a></h3>

<p>This is when you are running just the sipXconfig server on one
machine. You can follow the instructions for running with all the
other sipX servers after making the following configurations
changes:</p>

<dl>
  <dt>Directing SIP message directly to sipXconfig's Profile Publisher.</dt>
   <dd>To direct SIP messages to the ProfilePublisher, a job normally done by
the sipXproxy, edit
file: <code>etc/sipxpbx/config.defs</code> and set following setting
to read the following values:
<pre>
    CONFIG_SERVER_SIP_PORT=5060
</pre>
  </dd>

  <dt>Only start sipXconfig related services</dt>
  <dd>Edit config file : <code>etc/sipxpbx/ProcessDefinitions.xml</code> and remove sections
<pre>      
          &lt;group name="CommServer" &gt;
          ...
          &lt;/group&gt;

          &lt;group name="MediaServer" &gt;
          ...
          &lt;/group&gt;
</pre>      
  </dd>
</dl>


<h2><a name="windows">Windows</a></h2>

<p>Currently there is no support for windows but here is a list of
steps towards supporting Windows. Please submit your findings and
patches back to mailing list</p>


<ol>
  <li>edit <code>config.properties.in</code> and replace all variables
with <code>@VAR@</code> symbol with where you have dependencies installed</li>

  <li>Run <code>ant</code> then <code>ant install</code> on all the
<code>build.xml</code> files in these directories and in this order:
      
      <ol>
	<li>common</li>
	<li>profilegenerator</li>
	<li>profilewriter</li>
	<li>profilepublisher</li>
      </ol>
  </li>      

  <li>Compiling the Profile Publisher's SIP agent w/ MSVC 6

<p>First, see the INSTALL instructions in sipXportLib on adding glib and 
pcre to the MSVC 6 environment.  Next, you must add Java's JNI include 
and library paths to your MSVC 6 environment following the same process.</p>

<p>Assuming that you installed the SDK in <code>C:\Program
Files\Java\j2sdk1.4.2_03</code> you will need to add the
following:</p>

<dl>
  <dt>Additional Includes:</dt>
   <dd>C:\Program Files\Java\j2sdk1.4.2_03\include</dd>
   <dd>C:\Program Files\Java\j2sdk1.4.2_03\include\win32</dd>

  <dt>Additional Libs:</dt>
  <dd>C:\Program Files\Java\j2sdk1.4.2_03\lib</dd>
</dl>

  </li>

  <li>Write a series of batch scripts that mimic what these scripts do or use Cygwin
      to start your system:
      <ol>
	 <li>startrmiregistry.sh</li>
	 <li>profilewriter.sh</li>
	 <li>profilegenerator.sh</li>
	 <li>profilepublisher.sh</li>
      </ol>
  </li>
      
</ol>  

<span id="lastmodified">
<!-- hhmts start -->
Last modified: Mon Nov 29 14:14:11 EST 2004
<!-- hhmts end -->
</span>

</body>
</html>
