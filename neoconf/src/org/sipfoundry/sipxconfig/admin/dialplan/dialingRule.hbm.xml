<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" 
	"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="org.sipfoundry.sipxconfig.admin.dialplan" default-lazy="false">
  <class name="DialPlan" table="dial_plan">
    <id name="id" column="dial_plan_id" type="int" unsaved-value="-1">
      <generator class="sequence">
        <param name="sequence">dial_plan_seq</param>
      </generator>
    </id>
    <list name="rules" cascade="all-delete-orphan">
      <key column="dial_plan_id"/>
      <index column="position"/>
      <one-to-many class="DialingRule"/>
    </list>
  </class>
  
  <class name="DialingRule" table="dialing_rule">
    <id name="id" column="dialing_rule_id" type="int" unsaved-value="-1">
      <generator class="sequence">
        <param name="sequence">dialing_rule_seq</param>
      </generator>
    </id>
    <property name="name" not-null="true"/>
    <property name="description"/>
    <property name="enabled"/>
    <property name="position"/>
    <list name="gateways" table="dialing_rule_gateway" cascade="save-update">
      <key column="dialing_rule_id"/>
      <index column="index"/>
      <many-to-many class="org.sipfoundry.sipxconfig.gateway.Gateway" column="gateway_id"/>
    </list>
    
    <joined-subclass name="CustomDialingRule" table="custom_dialing_rule">
      <key column="custom_dialing_rule_id"/>
      <component name="callPattern" class="CallPattern">
        <property name="digits" column="call_pattern_digits"
          type="org.sipfoundry.sipxconfig.admin.dialplan.CallDigits$UserType"/>
        <property name="prefix" column="call_pattern_prefix"/>
      </component>
      <list name="dialPatterns" table="dial_pattern">
        <key column="custom_dialing_rule_id"/>
        <index column="index"/>
        <composite-element class="DialPattern">
          <property name="prefix" column="element_prefix"/>
          <property name="digits" column="element_digits"/>
        </composite-element>
      </list>
      <bag name="permissions" table="custom_dialing_rule_permission">
        <key column="custom_dialing_rule_id"/>
        <element type="org.sipfoundry.sipxconfig.common.Permission$UserType"
          column="permission"/>
      </bag>
    </joined-subclass>
    
    <joined-subclass name="EmergencyRule" table="emergency_dialing_rule">
      <key column="emergency_dialing_rule_id"/>
      <property name="optionalPrefix"/>
      <property name="emergencyNumber"/>
      <property name="useMediaServer"/>
    </joined-subclass>
    
    <joined-subclass name="InternalRule" table="internal_dialing_rule">
      <key column="internal_dialing_rule_id"/>
      <many-to-one name="autoAttendant" column="auto_attendant_id"
        class="org.sipfoundry.sipxconfig.admin.dialplan.AutoAttendant"/>
      <property name="localExtensionLen"/>
      <property name="voiceMail"/>
      <property name="voiceMailPrefix"/>
      <property name="aaAliases"/>
    </joined-subclass>
    
    <joined-subclass name="InternationalRule" table="international_dialing_rule">
      <key column="international_dialing_rule_id"/>
      <property name="internationalPrefix"/>
    </joined-subclass>
    
    <joined-subclass name="LocalRule" table="local_dialing_rule">
      <key column="local_dialing_rule_id"/>
      <property name="externalLen"/>
      <property name="pstnPrefix"/>
    </joined-subclass>
    
    <joined-subclass name="LongDistanceRule" table="long_distance_dialing_rule">
      <key column="international_dialing_rule_id"/>
      <property name="areaCodes"/>
      <property name="externalLen"/>
      <property name="longDistancePrefix"/>
      <property name="permission"
        type="org.sipfoundry.sipxconfig.common.Permission$UserType"/>
      <property name="pstnPrefix"/>
    </joined-subclass>
    
  </class>
	  
  <query name="dialingRuleIdsWithName">
    <![CDATA[select dr.id from DialingRule dr where dr.name = :value]]>
  </query>  
	
</hibernate-mapping>
