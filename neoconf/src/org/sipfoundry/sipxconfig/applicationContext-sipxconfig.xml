<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
	"http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
	<!--
      -  S Y S T E M  D I R E C T O R I E S
	  -  evaluates system directory variables e.g. ${sysdir.*} in this file
	  --> 
	<bean id="sysdir.properties" class="org.springframework.core.io.ClassPathResource">
		<constructor-arg index="0"><value>sysdir.properties</value></constructor-arg>
	</bean>
	<bean id="sysdir" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="location">
			<ref bean="sysdir.properties"></ref>			
		</property>
	</bean>
	<!--
       - P O S T G R E S
       -->
	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" 
		destroy-method="close">
		<property name="driverClassName">
			<value>org.postgresql.Driver</value>
			<!-- useful for debugging -->
			<!-- value>com.p6spy.engine.spy.P6SpyDriver</value -->
		</property>
		<property name="url">
			<value>jdbc:postgresql://localhost/PDS</value>
		</property>
		<property name="username">
			<value>postgres</value>
		</property>
	</bean>
	<!--
       - T R A N S A C T I O N  S U P P O R T
       -->
	<bean id="transactionManager" 
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource">
			<ref local="dataSource"/>
		</property>
	</bean>
	<!--
      - H I B E R N A T E   F A C T O R Y
      -->
	<bean id="sessionFactory" 
		class="org.springframework.orm.hibernate.LocalSessionFactoryBean">
		<property name="dataSource">
			<ref local="dataSource"/>
		</property>
		<property name="mappingResources">
			<list>
				<value>org/sipfoundry/sipxconfig/sipxconfig.hbm.xml</value>
			</list>
		</property>
		<property name="hibernateProperties">
			<props>
				<prop key="hibernate.dialect"> 
					net.sf.hibernate.dialect.PostgreSQLDialect</prop>
				<prop key="hibernate.query.substitutions">true=1 false=0</prop>
				<prop key="hibernate.show_sql">true</prop>
			</props>
		</property>
	</bean>
	<!--
      - H I B E R N A T E   S E S S I O N
      -->
	<bean id="hibernateInterceptor" 
		class="org.springframework.orm.hibernate.HibernateInterceptor">
		<property name="sessionFactory">
			<ref bean="sessionFactory"/>
		</property>
	</bean>
	<!--
	  - V E L O C I T Y
	  -->
	<bean id="velocityEngine" 
	  class="org.springframework.ui.velocity.VelocityEngineFactoryBean">
	  <property name="resourceLoaderPath"><value>file:${sysdir.etc}</value></property>          
	</bean>
	<!--
      -  S E T T I N G  D A O  I M P L
	  -->
	<bean id="settingDaoImpl" 
		class="org.sipfoundry.sipxconfig.setting.SettingDaoImpl">
		<property name="sessionFactory">
			<ref bean="sessionFactory"/>
		</property>
	</bean>
	<!--
      -  S E T T I N G  D A O 
	  -->
	<bean id="settingDao" 
		class="org.springframework.aop.framework.ProxyFactoryBean">
		<property name="proxyInterfaces">
			<value>org.sipfoundry.sipxconfig.setting.SettingDao</value>
		</property>
		<property name="interceptorNames">
			<list>
				<value>hibernateInterceptor</value>
				<value>settingDaoImpl</value>
			</list>
		</property>
	</bean>
	<!--
      - P H O N E  C O N T E X T   I M P L
      -->
	<bean id="phoneContextImpl" 
		class="org.sipfoundry.sipxconfig.phone.PhoneContextImpl">
		<property name="sessionFactory">
			<ref bean="sessionFactory"/>
		</property>
		<property name="phoneIds">
			<list>
				<value>polycom300</value>
				<value>polycom500</value>
				<value>polycom600</value>
			</list>
		</property>
		<property name="settingDao">
			<ref bean="settingDao"/>
		</property>
	</bean>
	<!--
      - P H O N E  C O N T E X T
      -->
	<bean id="phoneContext" 
		class="org.springframework.aop.framework.ProxyFactoryBean">
		<property name="proxyInterfaces">
			<value>org.sipfoundry.sipxconfig.phone.PhoneContext</value>
		</property>
		<property name="interceptorNames">
			<list>
				<value>hibernateInterceptor</value>
				<value>phoneContextImpl</value>
			</list>
		</property>
	</bean>
	<!--
	  - P H O N E  M O D E L S
	  - hoping to move this external file for end user modification
	  - TODO: Normalize common settings into Config Bean(s)
	  -->
	<bean id="polycomConfig" class="org.sipfoundry.sipxconfig.phone.polycom.PolycomPhoneConfig">
		<property name="velocityEngine">
			<ref bean="velocityEngine"/>
		</property>
		<property name="tftpRoot">
			<value>${sysdir.phone}/profile/tftproot</value>
		</property>
    </bean>
	<bean id="polycom300" class="org.sipfoundry.sipxconfig.phone.polycom.PolycomPhone">
		<property name="config">
			<ref local="polycomConfig"/>
		</property>
		<property name="systemDirectory">
			<value>${sysdir.etc}</value>
		</property>
		<property name="modelId">
			<value>polycom300</value>
		</property>
	</bean>
	<bean id="polycom500" class="org.sipfoundry.sipxconfig.phone.polycom.PolycomPhone">
		<property name="config">
			<ref local="polycomConfig"/>
		</property>
		<property name="systemDirectory">
			<value>${sysdir.etc}</value>
		</property>
		<property name="modelId">
			<value>polycom500</value>
		</property>
	</bean>
	<bean id="polycom600" class="org.sipfoundry.sipxconfig.phone.polycom.PolycomPhone">
		<property name="config">
			<ref local="polycomConfig"/>
		</property>
		<property name="systemDirectory">
			<value>${sysdir.etc}</value>
		</property>
		<property name="modelId">
			<value>polycom600</value>
		</property>
	</bean>
	<bean id="generic" class="org.sipfoundry.sipxconfig.phone.GenericPhone" singleton="false">		
	</bean>

	<!--
	  - D I A L   P L A N S
	  - TODO: move to separate file
	  -->
    <bean id="dialRuleFactory" class="org.sipfoundry.sipxconfig.admin.dialplan.DialingRuleFactory"/>
    
    <bean id="defaultInternalRule" class="org.sipfoundry.sipxconfig.admin.dialplan.InternalRule">
        <property name="name">
            <value>Internal</value>
        </property>
        <property name="description">
            <value>Default internal dialing plan</value>
        </property>
        <property name="enabled">
        	<value>true</value>
        </property>
        <property name="autoAttendant">
            <value>100</value>
        </property>
        <property name="voiceMail">
            <value>101</value>
        </property>
        <property name="voiceMailPrefix">
            <value>8</value>
        </property>
    </bean>
    
    <bean id="defaultEmergencyRule" class="org.sipfoundry.sipxconfig.admin.dialplan.EmergencyRule">
        <property name="name">
			<value>Emergency</value>            
        </property>
        <property name="description">
            <value>Emergency dialing plan</value>
        </property>
        <property name="enabled">
        	<value>true</value>
        </property>
        <property name="emergencyNumber">
        	<value>911</value>
        </property>        
    </bean>

    <bean id="defaultLongDistanceRule" class="org.sipfoundry.sipxconfig.admin.dialplan.LongDistanceRule">
        <property name="name">
			<value>Long Distance</value>            
        </property>
        <property name="description">
            <value>Long distance dialing plan</value>
        </property>
        <property name="enabled">
        	<value>false</value>
        </property>
        <property name="pstnPrefix">
        	<value>9</value>
        </property>        
        <property name="longDistancePrefix">
        	<value>1</value>
        </property>        
        <property name="externalLen">
        	<value>7</value>
        </property>        
    </bean>
    
    <bean id="defaultLocalRule" class="org.sipfoundry.sipxconfig.admin.dialplan.LocalRule">
        <property name="name">
			<value>Local</value>            
        </property>
        <property name="description">
            <value>Local dialing</value>
        </property>
        <property name="enabled">
        	<value>false</value>
        </property>
        <property name="pstnPrefix">
        	<value>9</value>
        </property>        
        <property name="externalLen">
        	<value>7</value>
        </property>        
    </bean>

    <bean id="flexDialPlan" class="org.sipfoundry.sipxconfig.admin.dialplan.FlexibleDialPlan">
    	<property name="rules">
        	<list>
                <ref bean="defaultEmergencyRule"></ref>
                <ref bean="defaultInternalRule"></ref>
                <ref bean="defaultLongDistanceRule"></ref>
                <ref bean="defaultLocalRule"></ref>
            </list>
        </property>
    </bean>
    
    <bean id="dialPlanManager" class="org.sipfoundry.sipxconfig.admin.dialplan.DialPlanManager">
    	<property name="flexDialPlan">
            <ref bean="flexDialPlan"></ref>
        </property>
    	<property name="ruleFactory">
            <ref bean="dialRuleFactory"></ref>
        </property>
        <property name="configDirectory">
			<value>${sysdir.etc}</value>            
        </property>
    </bean>
</beans>