<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
	"http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
  <!--
    - P H O N E  C O N T E X T   I M P L
  -->
  <!-- 
    phone models defintion
  -->
  <bean id="org.sipfoundry.sipxconfig.phone.Phone.MODEL"
    class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean" />

  <bean id="nakedPhoneModelSource"
    class="org.sipfoundry.sipxconfig.device.BeanFactoryModelSource">
    <property name="prefix" value="org.sipfoundry.sipxconfig.phone." />
  </bean>

  <bean id="phoneModelSource" class="org.sipfoundry.sipxconfig.device.FilteredModelSource">
    <property name="modelSource" ref="nakedPhoneModelSource" />
  </bean>

  <bean id="phoneContextImpl" class="org.sipfoundry.sipxconfig.phone.PhoneContextImpl">
    <property name="sessionFactory" ref="sessionFactory" />
    <property name="settingDao" ref="settingDaoImpl" />
    <property name="coreContext" ref="coreContext" />
    <property name="systemDirectory" value="${sysdir.etc}" />
    <property name="phoneDefaults" ref="phoneDefaults" />
    <property name="phoneModelSource" ref="phoneModelSource" />
    <property name="intercomManager" ref="intercomManager" />
  </bean>

  <!--
    - P H O N E  C O N T E X T
  -->
  <bean id="phoneContext" class="org.springframework.aop.framework.ProxyFactoryBean"
    parent="abstractDao">
    <property name="proxyInterfaces">
      <value>org.sipfoundry.sipxconfig.phone.PhoneContext</value>
    </property>
    <property name="target">
      <ref local="phoneContextImpl" />
    </property>
  </bean>

  <bean id="eagerRestartManager" class="org.sipfoundry.sipxconfig.phone.RestartManagerImpl">
    <property name="phoneContext">
      <ref local="phoneContext" />
    </property>
    <property name="jobContext" ref="jobContext" />
  </bean>

  <bean id="restartManager" class="org.sipfoundry.sipxconfig.device.LazyRestartManagerImpl"
    init-method="init">
    <property name="target">
      <ref local="eagerRestartManager" />
    </property>
    <property name="sleepInterval" value="5000" />
  </bean>

  <bean id="eagerProfileManager" class="org.sipfoundry.sipxconfig.phone.ProfileManagerImpl">
    <property name="phoneContext">
      <ref local="phoneContext" />
    </property>
    <property name="restartManager">
      <ref local="restartManager" />
    </property>
    <property name="jobContext" ref="jobContext" />
  </bean>

  <bean id="profileManager" class="org.sipfoundry.sipxconfig.device.LazyProfileManagerImpl"
    init-method="init">
    <property name="target">
      <ref local="eagerProfileManager" />
    </property>
    <property name="sleepInterval" value="5000" />
  </bean>

  <!-- Define new phone models here, order is not important -->
  <bean id="unmanagedPhone" class="org.sipfoundry.sipxconfig.phone.Phone" singleton="false"
    parent="beanWithSettings">
    <property name="phoneContext">
      <ref bean="phoneContext" />
    </property>
    <property name="webDirectory">
      <!-- 
        - this is directory for a preferred place for serving 
        - phone configuration profiles for http access
        -    http://host:8090/phone/profile/docroot/, 
      -->
      <value>${sysdir.phone}/profile/docroot</value>
    </property>
    <property name="tftpRoot">
      <value>${sysdir.phone}/profile/tftproot</value>
    </property>
    <property name="velocityEngine">
      <ref bean="velocityEngine" />
    </property>
    <property name="sipService">
      <ref bean="sip" />
    </property>
  </bean>

  <!-- S I P -->
  <bean id="sip" class="org.sipfoundry.sipxconfig.phone.SipServiceImpl" />
  <!-- Line -->
  <bean id="line" class="org.sipfoundry.sipxconfig.phone.Line" singleton="false"
    parent="beanWithSettings" />
</beans>

