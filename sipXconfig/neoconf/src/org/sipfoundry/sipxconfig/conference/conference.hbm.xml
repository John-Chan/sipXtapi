<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" 
	"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="org.sipfoundry.sipxconfig.conference" default-lazy="false">
  
  <class name="Bridge" table="meetme_bridge">
    <id name="id" column="meetme_bridge_id" type="int" unsaved-value="-1">
      <generator class="sequence">
        <param name="sequence">meetme_seq</param>
      </generator>
    </id>
    <property name="enabled"/>
    <property name="name"/>
    <property name="description"/>
    
    <many-to-one cascade="all" name="valueStorage" column="value_storage_id"
      class="org.sipfoundry.sipxconfig.setting.ValueStorage"
      foreign-key="fk_meetme_bridge_value_storage"/>
    
    <set name="conferences" inverse="true" table="meetme_conference" cascade="all,delete-orphan">
      <key column="meetme_bridge_id"/>
      <one-to-many class="Conference"/>
    </set>
  </class>
  
  <class name="Conference" table="meetme_conference">
    <id name="id" column="meetme_conference_id" type="int" unsaved-value="-1">
      <generator class="sequence">
        <param name="sequence">meetme_seq</param>
      </generator>
    </id>
    <property name="enabled"/>
    <property name="name"/>
    <property name="description"/>
    <property name="extension"/>
    
    <many-to-one cascade="all" name="valueStorage" column="value_storage_id"
      class="org.sipfoundry.sipxconfig.setting.ValueStorage"
      foreign-key="fk_meetme_conference_value_storage"/>

    <set name="participants" inverse="true" table="meetme_participant" cascade="all,delete-orphan">
      <key column="meetme_conference_id"/>
      <one-to-many class="Participant"/>
    </set>
        
    <many-to-one name="bridge" column="meetme_bridge_id" class="Bridge" not-null="true" lazy="true"
      foreign-key="fk_meetme_conference_bridge"/>    
  </class>
  
  <class name="Participant" table="meetme_participant">
    <id name="id" column="meetme_participant_id" type="int" unsaved-value="-1">
      <generator class="sequence">
        <param name="sequence">meetme_seq</param>
      </generator>
    </id>
    
    <many-to-one cascade="all" name="valueStorage" column="value_storage_id"
      class="org.sipfoundry.sipxconfig.setting.ValueStorage"
      foreign-key="fk_meetme_participant_value_storage"/>
    
    <many-to-one name="conference" column="meetme_conference_id" class="Conference" not-null="true"
      lazy="true" foreign-key="fk_meetme_participant_conference"/>
    
    <many-to-one name="user" column="user_id" not-null="true"
      class="org.sipfoundry.sipxconfig.common.User" foreign-key="fk_meetme_participant_user"/>    
  </class>
  
  <query name="participantIdForUser">
    <![CDATA[select p.id from Participant p where p.user = :user]]>
  </query>

  <query name="participantForConferenceAndUser">
    <![CDATA[from Participant p where p.user = :user and p.conference = :conference]]>
  </query>
  
  <query name="conferenceIdsWithExtension">
    <![CDATA[select conf.id from Conference conf where conf.extension = :value]]>
  </query>
  
</hibernate-mapping>
