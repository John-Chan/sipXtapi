<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>sipXconfig Installation</title>
  <link rel="stylesheet" type="text/css" href="manual.css" />
</head>
<body id="installation">
<pre class="hide"><!-- lynx ignores CSS and shows this -->
This file was generated using the following command.  If you are
already looking at this from a web browser, then please ignore this
message.

  cd doc;ant text-doc

----------------------------------------------------------
</pre>
<h1>Installation</h1>
<ol>
  <li><a href="#rh">For Redhat Users</a>
    <ol>
      <li><a href="#rh-system">System Installation</a></li>
      <li><a href="#rh-jdk">Installing Java RPM</a></li>
      <li><a href="#yum">Installing dependencies with yum</a></li>
      <li><a href="#rh-sipx">Installing RPMs from SIPfoundry</a></li>
    </ol>
  </li>
  <li><a href="#src">Installing From Source and Non-Redhat Users</a>
    <ol>
      <li><a href="#src-dep">Dependencies</a></li>
      <li><a href="#src-env">Environment Variables</a></li>
      <li><a href="#src-compile">Compile and Installation</a></li>
      <li><a href="#src-jboss">JBoss Setup</a></li>
      <li><a href="#src-db">Postgres Database Setup</a></li>
    </ol>
  </li>
  <li><a href="#additional">Additional Setup</a>
    <ol>
      <li><a href="#tftp">TFTP Setup for phone boot server</a></li>
      <li><a href="#security">Security</a></li>
    </ol>
  </li>
  <li><a href="#run">Running</a>
    <ol>
      <li><a href="#run-sipx">Running with other sipX servers</a></li>
      <li><a href="#run-alone">Running Standalone</a></li>
    </ol>
  </li>
  <li><a href="#windows">Windows</a></li>
</ol>
<h2><a name="rh">For Redhat Users</a></h2>
<p>These instructions apply to Enterprise and Fedora systems unless
explicitly noted</p>
<h3><a name="rh-system">System Installation</a></h3>
<ol>
  <li>Install Redhat from CDs. You can select any set of packages
including the minimum set of packages labeled "router configuration" in
the Redhat installer process</li>
  <li>When prompted for firewall support, select "no firewall support"
or open up the following ports in your iptables: 80, 8080, 8443, 8090,
8091, 5060 and 5090</li>
</ol>
<h3><a name="rh-jdk">Installing Java RPM</a></h3>
<ul>
  <li>j2sdk 1.4 or greater available by opening your webbrowser to this
URL:<br />
    <a href="http://java.sun.com/j2se/1.4.2/download.html">http://java.sun.com/j2se/1.4.2/download.html</a>
  </li>
</ul>
<h3><a name="yum">Installing dependencies with yum</a></h3>
<p>Common to all Fedora systems, you need to add the following packages:</p>
<pre>  yum install tftp-server httpd postgresql-server<br /></pre>
<p>Redhat enterprise:</p>
<pre>  yum install tftp-server httpd rh-postgresql-server<br /></pre>
<h4>Fedora Core 3: Java build tools using JPackage</h4>
<p>You can add jpackage to your yum repository as follows (see <a
 href="http://www.mksearch.mkdoc.org/howto/jpackage-fc3/">http://www.mksearch.mkdoc.org/howto/jpackage-fc3/</a>
for more information.)</p>
Remove previous ant if you have it installed
<pre>   rpm -e apache-ant<br /></pre>
Now setup yum
<pre>  wget -P /tmp http://jpackage.org/jpackage.asc<br />  rpm --import /tmp/jpackage.asc<br />  wget -P /etc/yum.repos.d http://jpackage.org/jpackage.repo<br /></pre>
<p>Now you can update your system to the required packages</p>
<pre>  yum install ant ant-nodeps junit ant-junit checkstyle checkstyle-optional ant-trax jakarta-commons-beanutils jakarta-commons-collections<br /></pre>
<h4>Fedora Core 2 and Redhat Enterprise: Java build tools using custom
rpm</h4>
<p>Although you can get RPMs from JPacakge, SIPfoundy has an RPM will
all the necesary tools you'll need. NOTE: This will also work on FC3 if
you run into trouble with using JPackage</p>
<pre>  wget http://www.sipfoundry.org/pub/sipX/depends/FC/2/apache-ant-1.6.2-2.noarch.rpm<br />  rpm -ivh apache-ant-1.6.2-2.noarch.rpm<br /></pre>
<h3><a name="rh-sipx">Installing sipX RPMs from SIPfoundry</a></h3>
<p>Download and install the following RPMs from <a
 href="http://www.sipfoundry.org/pub/sipX/">http://www.sipfoundry.org/pub/sipX/</a></p>
<ul>
  <li>sipx-jboss-4.0.1-4.noarch.rpm</li>
  <li>sipxportlib</li>
  <li>sipxtacklib</li>
  <li>sipxcommserverlib</li>
  <li>sipxconfig</li>
  <li>sipxproxy</li>
  <li>sipxregistry</li>
  <li>sipxpublisher</li>
  <li>sipxvxml</li>
  <li>sipxpbx</li>
</ul>
<h2><a name="src">Installing From Source and Non-Redhat Users</a></h2>
<p>Install the following software packages. Follow the installation
instructions for your OS. If there is any special installation
instructions, they will be noted.</p>
<h3><a name="src-dep">Dependencies</a></h3>
<dl>
  <dt>sipXportLib (same version sipXconfig)</dt>
  <dd><a href="http://www.sipfoundry.org/sipXportLib">http://www.sipfoundry.org/sipXportLib</a></dd>
  <dt>sipXtackLib (same version sipXconfig)</dt>
  <dd><a href="http://www.sipfoundry.org/sipXtack">http://www.sipfoundry.org/sipXtack</a></dd>
  <dt>sipXcommserverLib (same version sipXconfig)</dt>
  <dd><a href="http://www.sipfoundry.org/sipXcommserverLib">http://www.sipfoundry.org/sipXcommserverLib</a></dd>
  <dt>sipXpbx (same version sipXconfig)</dt>
  <dd><a href="http://www.sipfoundry.org/sipXpbx">http://www.sipfoundry.org/sipXpbx</a></dd>
  <dt>Java SDK 1.4 (tested w/1.4.2.03)</dt>
  <dd><a href="http://java.sun.com">http://java.sun.com</a></dd>
  <dt>postgres 7.3 (tested with 7.3.4)</dt>
  <dd><a href="http://www.postgresql.org/">http://www.postgresql.org/</a></dd>
  <dt>JBoss 4.0.1 (includes Tomcat 5.0)</dt>
  <dd><a
 href="http://prdownloads.sourceforge.net/jboss/jboss-4.0.1sp1.tar.gz">http://prdownloads.sourceforge.net/jboss/jboss-4.0.1sp1.tar.gz</a></dd>
  <dt>Ant 1.6 (tested with 1.6.1)</dt>
  <dd><a href="http://ant.apache.org/">http://ant.apache.org/</a></dd>
</dl>
<h3><a name="src-env">Environment Variables</a></h3>
<p>Set the following environment variables:</p>
<dl>
  <dt>JAVA_HOME</dt>
  <dd>to where you installed java. This setting is just used to
compile. After installation the <code>sipx-config --jdk</code> is used
to find java dynamically. That means you can upgrade your java
and not break your installation
    <pre>       Example: <br />           export JAVA_HOME=/usr/java/j2sdk1.4.2_03<br />   </pre>
  </dd>
  <dt>ANT_HOME</dt>
  <dd>where you unzipped (e.g. installed) ant
    <pre>       Example: <br />            export ANT_HOME=/opt/apache-ant-1.6.2<br />   </pre>
  </dd>
  <dt>JBOSS_HOME</dt>
  <dd>where you unzipped JBoss
    <pre>       Example: <br />          export JBOSS_HOME=/opt/jboss-4.0.1<br />  </pre>
  </dd>
</dl>
<h3><a name="src-compile">Compiling and Installation</a></h3>
<p>If you've obtained your source from subversion, and not from a tar
file, run this command:</p>
<pre>  autoreconf -if<br /></pre>
<p>Now compile and install sipXconfig by running this command:</p>
<pre>     ./configure<br />     make<br />     make install<br /></pre>
<h3><a name="src-jboss">JBoss Setup</a></h3>
<p>If you've installed JBoss from <a
 href="http://www.sipfoundry.org/pub/sipX/depends/">the RPM found on
sipfoundry website</a> then add user 'sipx' (or user defined
SIPXPBXUSER) to the jboss user group and skip the next few steps about
patching JBoss and skip to setting up your database</p>
<p> JBoss 4.0 is distributed with several server configurations. They
are located under $JBOSS_HOME/server directory. By default sipXconfig
components will run under "default" configuration. One can change it by
creating a custom configuration:
</p>
<ul>
  <li>make a copy of a default configuration
    <pre>        cp -rp $JBOSS_HOME/server/default $JBOSS_HOME/server/sipx<br />    </pre>
  </li>
  <li>set environment variable to point to your new server
configuration
    <pre>        export env JBOSS_SERVER_CONF=sipx<br />    </pre>
  </li>
  <li>run (or re-run) configure script</li>
</ul>
<p> Standard JBoss installation needs to be patched to use Postgres
database and to enable sipX provided authentication modules.
</p>
<ol>
  <li>Run the following patch after installing JBoss
    <pre>      patch -d ${JBOSS_HOME}/server/${JBOSS_SERVER_CONF} -p0 &lt; meta/sipx-jboss4-configure.patch<br /></pre>
If you use custom JBoss server configuration use its name instead of <q>default</q>.
Every configuration has to be patched separately. </li>
  <li>Remove Hibernate distributed with JBoss (it's too old to support sipXconfig):
      <pre> rm -rf ${JBOSS_HOME}/server/${JBOSS_SERVER_CONF}/deploy/jboss-hibernate.deployer</pre>
      Hibernate 2.1 required by sipXconfig is included in the source distribution.
  </li>
  <li>Copy in web certificate for basic https support<br />
    <pre>     cp meta/ssl.pkcs12 ${JBOSS_HOME}/server/${JBOSS_SERVER_CONF}/conf</pre>
  </li>
  <li>Be sure user running sipxpbx (most cases 'sipx') has full r/w
access to all files and directories in <code>${JBOSS_HOME}</code></li>
</ol>
<p> If you are runnning sipXconfig 2.6.x (or older) on the same machine
as version 2.7 you have to reconfigure your JBOSS_HOME every time you
switch between 2.6 and 2.7.
</p>
<h3><a name="src-db">Postgresql Database Setup</a></h3>
<p>Postgres needs to always be running on your system. If you've
installed sipXconfig from RPM, you shouldn't have to do this.</p>
<p>To start Postgres on Redhat 9 or Fedora systems run this command.</p>
<pre>      service postgresql start <br />  </pre>
<p>To start Postgres on Enterprise 3 systems run this command.</p>
<pre>      service rhdb start <br />  </pre>
<p>To start Postgres on Debian, and perhaps other linux distributions,
if you don't already have a /etc/init.d/postgresql you may need to get
the example from the contrib directory in the postgres distibution: </p>
<pre>	cp contrib/start-scripts/linux /etc/init.d/postgresql<br /></pre>
<p>It's recommended you should have Postgres start automatically when
your machine
restarts (usually in runlevels 3 and 5).</p>
<p>Fedora and Redhat 9 users should run this command:</p>
<pre>      chkconfig postgresql on<br /></pre>
<p>Redhat Enterprise 3 users should run this command:</p>
<pre>      chkconfig rhdb on<br /></pre>
<p>Edit Postgres config files to work. This will open up TCP
connections and
allow localhost to connect to Postgres</p>
<pre>     /usr/local/sipx/bin/sipxdbmgr --setup<br />     /usr/local/sipx/bin/sipxdbmgr --create PDS<br />     /usr/local/sipx/bin/sipxdbmgr --create SDS<br /></pre>
<h2><a name="additional">Additional Setup</a></h2>
<h3><a name="tftp">TFTP</a></h3>
<h4>TFTP on Redhat</h4>
<p>Run the following commands</p>
<pre>  ${EDITOR} /etc/xinetd.d/tftp<br /></pre>
<p>make the following <strong>edits</strong>, if you've installed via
RPM, then <code>{where you installed sipXconfig}</code> is empty:</p>
<pre>   disable  = no<br />   server_args  = -s <em>{where you installed sipXconfig}</em>/var/sipxdata/configserver/phone/profile/tftproot<br /></pre>
<p>Run the following commands for your edits to take affect</p>
<pre>  # ensure tftp server is not already running<br />  ps aux | grep tftp<br /> <br />  # if so, stop it<br />  kill -15 {tftp pid}<br /><br />  # restart xinit.d that in turn will start tftp on demand<br />  service xinetd restart<br /></pre>
<h4>TFTP on Gentoo</h4>
<p>Run the following commands</p>
<pre>  emerge net-misc/tftp-hpa<br />  ${EDITOR} /etc/conf.d/in.tftpd<br /></pre>
<p>make the following edits</p>
<pre>  INTFTPD_PATH="<em>{where you installed sipXconfig}</em>/var/sipxdata/configserver/phone/profile/tftproot"<br /></pre>
<p>then run the following command</p>
<pre>  /etc/init.d/in.tftp start<br /></pre>
<h3><a name="security">Security</a></h3>
<p>Set up an SSL key using the instructions in
sipXcommserverLib/doc/INSTALL.ssl or
/usr/share/doc/sipxcommserverlib-<em>version</em>/INSTALL.ssl.</p>
<h2><a name="run">Running</a></h2>
<h3><a name="run-sipx">Running with other sipX servers</a></h3>
<p>This is the normal configuration. It's where all the sipx servers
like the proxy, status server, mediaserver, etc. are running on the
same machine. In this case you will want to follow the instructions in
the sipXpbx project for starting the <code>sipxpbx</code> service.
This will control the starting and stopping of the necessary
components of the configuration system. The sipXproxy will direct SIP
messages to the Profile Publisher automatically. If you are using
another SIP proxy other than the sipXproxy, or running the sipXproxy on
another machine, follow next section "Running Standalone".</p>
<h3><a name="run-alone">Running Standalone</a></h3>
<p>This is when you are running just the sipXconfig server on one
machine. You can follow the instructions for running with all the
other sipX servers after making the following configurations
changes:</p>
<dl>
  <dt>Directing SIP message directly to sipXconfig's Profile Publisher.</dt>
  <dd>To direct SIP messages to the ProfilePublisher, a job normally
done by
the sipXproxy, edit
file: <code>etc/sipxpbx/config.defs</code> and set following setting
to read the following values:
    <pre>    CONFIG_SERVER_SIP_PORT=5060<br /></pre>
  </dd>
  <dt>Only start sipXconfig related services</dt>
  <dd>Edit config file : <code>etc/sipxpbx/ProcessDefinitions.xml</code>
and remove sections
    <pre>      <br />          &lt;group name="CommServer" &gt;<br />          ...<br />          &lt;/group&gt;<br /><br />          &lt;group name="MediaServer" &gt;<br />          ...<br />          &lt;/group&gt;<br /></pre>
  </dd>
</dl>
<h2><a name="windows">Windows</a></h2>
<p>Currently there is no support for windows but here is a list of
steps towards supporting Windows. Please submit your findings and
patches back to mailing list</p>
<ol>
  <li>edit <code>config.properties.in</code> and replace all variables
with <code>@VAR@</code> symbol with where you have dependencies
installed</li>
  <li>Run <code>ant</code> then <code>ant install</code> on all the
    <code>build.xml</code> files in these directories and in this
order:
    <ol>
      <li>common</li>
      <li>profilegenerator</li>
      <li>profilewriter</li>
      <li>profilepublisher</li>
    </ol>
  </li>
  <li>Compiling the Profile Publisher's SIP agent w/ MSVC 6
    <p>First, see the INSTALL instructions in sipXportLib on adding
glib and pcre to the MSVC 6 environment. Next, you must add Java's JNI
include and library paths to your MSVC 6 environment following the same
process.</p>
    <p>Assuming that you installed the SDK in <code>C:\Program
Files\Java\j2sdk1.4.2_03</code> you will need to add the
following:</p>
    <dl>
      <dt>Additional Includes:</dt>
      <dd>C:\Program Files\Java\j2sdk1.4.2_03\include</dd>
      <dd>C:\Program Files\Java\j2sdk1.4.2_03\include\win32</dd>
      <dt>Additional Libs:</dt>
      <dd>C:\Program Files\Java\j2sdk1.4.2_03\lib</dd>
    </dl>
  </li>
  <li>Write a series of batch scripts that mimic what these scripts do
or use Cygwin to start your system:
    <ol>
      <li>startrmiregistry.sh</li>
      <li>profilewriter.sh</li>
      <li>profilegenerator.sh</li>
      <li>profilepublisher.sh</li>
    </ol>
  </li>
</ol>
<span id="lastmodified"><!-- hhmts start -->2006-06-13 14:56:46-0400<!-- hhmts end --></span>
</body>
</html>
