

<html>
    <head>
        <script src="../script/validate.js"></script>
        <script language="JavaScript">
            var validator = new Validate();
            var currentID;

            function getValues()
            {
                var form = document.frmEditSpeeddial;
                var query = location.search.substring(1);
                var values = new Array();
                var pairs = query.split( "&" );
                for ( i = 0; i < pairs.length; i++ )
                {
                    var pos = pairs[i].indexOf( "=" );
                    values[i] = pairs[i].substring(pos + 1);
                }
                var id = values[0];
                var rpid = values[1];
                form.oldid.value = id;
                form.rpid.value = rpid;
                var div;

                if( this.opener.location.href.indexOf("/pds/ui/sipxchange") != -1 )
                {
                    div = this.opener.mainFrame.document.getElementById(id);
                }
                else
                {
                    div = this.opener.mainFrame.mainFrame.document.getElementById(id);
                }
                var children = div.childNodes;
                for ( i = 0; i < children.length; i++ )
                {
                    if ( children[i].id == "speeddial_sdid" )
                    {
                        currentID = form.sdid.value = children[i].value;
                    }
                    else if ( children[i].id == "speeddial_label" )
                    {
                        form.label.value = children[i].value;
                    }
                    else if ( children[i].id == "speeddial_address" )
                    {
                        form.address.value = children[i].value;
                    }
                    else if ( children[i].id == "speeddial_type" )
                    {
                        for ( var j = 0; j < form.type.options.length; j++ )
                        {
                            if ( form.type.options[j].value == children[i].value )
                            {
                                form.type.options[j].selected = true;
                            }
                        }
                    }
                }
            }
            function formSubmit( form )
            {
                var nFlag = true;
                var inputs;
                var parent = String( this.opener.parent.location );
                if ( parent.indexOf("ui/sipxchange") != -1 )
                {
                    inputs = this.opener.top.mainFrame.document.getElementsByTagName('INPUT');
                }
                else
                {
                    inputs = this.opener.top.mainFrame.mainFrame.document.getElementsByTagName('INPUT');
                }
                for ( i = 0; i < inputs.length; i++ )
                {
                    if ( inputs[i].id == "sdid" )
                    {
                        if ( inputs[i].value == form.sdid.value &&
                            inputs[i].value != currentID )
                        {
                            nFlag = false;
                        }
                    }
                }
                // var formIsValid = true;
                if ( form.sdid.value == "" || isNaN( validator.trim(form.sdid.value) ) )
                {
                     alert("Please fill in the Speed Dial Number field as an Integer");
                }
                else if (validator.trim(form.sdid.value).length > 9)
                {
                    alert("The max number of digits allowed in the Speed Dial Number field is 9");
                }
                else if ( nFlag == false )
                {
                    var msg = "The speed dial number must be unique.\n" +
                              "Please choose a different number. ";

                    alert( msg );
                    form.id.value = "";
                }
                else if ( form.label.value == "" )
                {
                        alert("Please fill in the Name field");
                }
                else if ( form.type.value == ""  )
                {
                    alert( "Please select a type from the Phone Number or SIP URL selection box" );
                }
                else if ( form.address.value == "" )
                {
                    alert("Please fill in the Address field");
                }
                else if ( ( form.type.value == "NUMBER" ) &&
                          (!validator.isPhoneNumber(validator.trim(form.address.value))) )
                {
                    var msg = "You have entered an invalid phone number.\n" +
                              "Only 0-9, space, *, #, +, -, p, i are valid.\n" +
                              "Please try again."
                    alert (msg);
                }
                else
                {
                    var sdid = validator.trim(form.sdid.value);
                    var label = validator.trim(form.label.value);
                    var type = validator.trim(form.type.value);
                    var address = validator.trim(form.address.value);
                    var id = form.oldid.value;
                    var rpid = form.rpid.value;
                    this.opener.top.mainFrame.add_speeddial(sdid, label, type, address,rpid, "true", id );
                    this.window.close();
                }
            }
            function closeWindow()
            {
                this.window.close();
            }
        </script>
        <title>Edit Speed Dial</title>
        <link rel="stylesheet" href="../../style/dms.css" type="text/css">
    </head>
    <body class="bglight" onload="getValues()">
        <p>&nbsp;</p>
		<p class="formtitle" align="center">Edit a Speed Dial Entry</p>
        <form name="frmEditSpeeddial">
            <table width="150" border="0" cellspacing="3" cellpadding="0" align="center">
                <tr>
                    <td class="formtext" nowrap>Speed dial number</td>
                    <td>
                        <input type="text" name="sdid" size="10">
                    </td>
                </tr>
                <tr>
                    <td class="formtext" nowrap>Name</td>
                    <td>
                        <input type="text" name="label" size="30">
                    </td>
                </tr>
                <tr>
                        <td class="formtext" nowrap>Phone number or SIP URL?</td>
                    <td>
                        <select name="type" size="2">
                            <option value="NUMBER">NUMBER</option>
                            <option value="URL">URL</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="formtext" nowrap>Number/URL</td>
                    <td>
                        <input type="text" name="address" size="30">
                    </td>
                </tr>
            </table>
            <br>
            <div align="center">
                <input type="button" name="cmdSubmitForm" value="Submit" onclick="formSubmit(this.form)">&nbsp;&nbsp;
                <input type="button" name="cmdCloseWindow" value="Cancel" onclick="closeWindow()"/>
            </div>
            <input type="Hidden" name="oldid">
            <input type="Hidden" name="rpid">
        </form>
    </body>
</html>
