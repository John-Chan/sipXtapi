<html>
    <head>
        <script src="../script/validate.js"></script>
        <script language="JavaScript">
            var validator = new Validate();
            function getValues()
            {

                var form = document.frmUserLine;
                var query = location.search.substring(1);
                var values = new Array();
                var pairs = query.split( "&" );
                for ( i = 0; i < pairs.length; i++ )
                {
                    var pos = pairs[i].indexOf( "=" );
                    values[i] = pairs[i].substring(pos + 1);
                }
                var id = values[0];
                var rpid = values[1];
                var contid = values[2];
                form.oldid.value = id;
                form.rpid.value = rpid;
                form.contid.value = contid;

                var div = this.opener.mainFrame.mainFrame.document.getElementById(id);
                var children = div.childNodes;
                for ( i = 0; i < children.length; i++ )
                {
                    if ( children[i].id == "uline_url" )
                    {
                        form.url.value = children[i].value;
                    }
                    else if ( children[i].id == "uline_registration" )
                    {
                        for ( var j = 0; j < form.registration.options.length; j++ )
                        {
                            if ( form.registration.options[j].value == children[i].value )
                            {
                                form.registration.options[j].selected = true;
                            }
                        }
                    }
                    else if ( children[i].id == "uline_allow_forwarding" )
                    {
                        for ( var j = 0; j < form.allow_forwarding.options.length; j++ )
                        {
                            if ( form.allow_forwarding.options[j].value == children[i].value )
                            {
                                form.allow_forwarding.options[j].selected = true;
                            }
                        }
                    }
                }
            }
            function formSubmit( form )
            {
                if ( form.url.value == "" )
                {
                        alert("Please fill in the SIP URL field");
                }
                else if ( form.registration.value == "" )
                {
                        alert("Please select from the registration selection box");
                }
                else if ( form.allow_forwarding.value == ""  )
                {
                    alert( "Please select from the Allow Forwarding selection box" );
                }
                else if ( !validator.isUserLineSIPURL(form.url.value) )
                {
                    var msg = "You have entered an invalid sip url.\n" +
                              "A sip url must contain sip:xxx@\n" +
                              "Please try again."
                    alert (msg);
                }
                else
                {
                    var url = validator.trim(form.url.value);
                    var registration = validator.trim(form.registration.value);
                    var allow_forwarding = validator.trim(form.allow_forwarding.value);
                    var id = form.oldid.value;
                    var rpid = form.rpid.value;
                    var contid = form.contid.value;
                    this.opener.top.mainFrame.replace_userline( url, registration,
                        allow_forwarding, rpid, id, contid );
                    this.window.close();
                }
            }
            function closeWindow()
            {
                this.window.close();
            }
        </script>
        <title>Edit User Line</title>
        <link rel="stylesheet" href="../../style/dms.css" type="text/css">
    </head>
    <body class="bglight" onload="getValues()">
        <p>&nbsp;</p>
		<p class="formtitle" align="center">Edit User Line</p>
        <form name="frmUserLine">
            <table width="250" border="0" cellspacing="3" cellpadding="0" align="center">
                <tr>
                    <td class="formtext">SIP URL</td>
                    <td>
                        <input type="text" name="url" size="40">
                    </td>
                </tr>
                <tr>
                    <td class="formtext">Register with host or provision line as is</td>
                    <td>
                        <select name="registration" size="3">
                            <option value="blank">&lt;BLANK&gt;</option>
                            <option value="PROVISION">PROVISION</option>
                            <option value="REGISTER">REGISTER</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="formtext" nowrap>Apply rules for call forwarding</td>
                    <td>
                        <select name="allow_forwarding" size="3">
                            <option value="blank">&lt;BLANK&gt;</option>
                            <option value="DISABLE">DISABLE</option>
                            <option value="ENABLE">ENABLE</option>
                        </select>
                    </td>
                </tr>
            </table>
            <input type="hidden" name="oldid"/>
            <input type="hidden" name="rpid"/>
            <input type="hidden" name="contid"/>
            <br>
            <div align="center">
                <input type="button" name="cmdSubmitForm" value="Submit" onclick="formSubmit(this.form)">&nbsp;&nbsp;
                <input type="button" name="cmdCloseWindow" value="Cancel" onclick="closeWindow()"/>
            </div>
        </form>
    </body>
</html>
