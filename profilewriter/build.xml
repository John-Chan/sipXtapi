<?xml version="1.0" encoding="UTF-8" ?>
<!-- $Id: build.xml,v 1.12 2001/04/19 17:55:36 starksm Exp $ -->

<project name="profilewriter" default="jar" basedir="." >

  <patternset id="test.classes" excludes="**"/>
  <property name="top.build.dir" value="${basedir}/.."/>
  <property name="build.dir" value="${top.build.dir}/profilewriter"/>

  <import file="../ant-targets.xml"/>

  <path id="base.path" >
      <pathelement location="${jdom.jar}" />
      <pathelement location="${log4j.jar}"/>
      <pathelement location="${common.jar}"/>
      <pathelement location="${netcomponents.jar}"/>
  </path>
  <property name="classpath" refid="base.path" />


  <!-- C O M P I L E -->
  <target name="compile" depends="init" >
      <javac srcdir="${src.dir}/"
         destdir="${classes.dir}"
         classpathref="base.path"
         debug="${debug}"
         debuglevel="${debuglevel}"
         deprecation="on"
         optimize="${optimize}"
         includes="**/*.java"
         excludes="**/Test*.java"/>

      <rmic base="${classes.dir}" includes="**/*Impl.class" 
          verify="yes" stubversion="1.2" classpathref="base.path" />
  </target>


  <!-- J A R -->
  <target name="jar" depends="compile" description="assemble profilewriter jar" >
     <jar jarfile="${dist.dir}/profilewriter.jar">
         <fileset dir="${classes.dir}" includes="**"/>
         <fileset file="${buildVersion.properties}"/>
     </jar>
  </target>


  <!-- I N S T A L L -->
  <target name="install">

    <!-- startup scripts -->
    <mkdir dir="${bin.dir}"/>
    <copy file="bin/profilewriter.sh.in" tofile="${bin.dir}/profilewriter.sh"/>
    <replace file="${bin.dir}/profilewriter.sh" 
        propertyfile="${top.build.dir}/config.properties">
      <replacefilter token="@JAVA_HOME@" property="java.home"/>
      <replacefilter token="@SIPXPBXCONF@" property="sipxpbx.conf.dir"/>
      <replacefilter token="@SIPXPBXDATA@" property="sipxpbx.data.dir"/>
      <replacefilter token="@bindir@" property="bin.dir"/>
    </replace>
    <chmod file="${bin.dir}/profilewriter.sh" perm="ugo+x"/>

    <!-- web system -->
    <copy file="${dist.dir}/profilewriter.jar" todir="${sipxconfig.lib.dir}"/>
    <mkdir dir="${www.dir}/doc/phone/applications"/>
    <mkdir dir="${www.dir}/doc/phone/catalog"/>
    <mkdir dir="${www.dir}/conf"/>
    <mkdir dir="${profile.dir}/docroot"/>
    <mkdir dir="${profile.dir}/tftproot"/>

    <!-- configuration -->
    <mkdir dir="${sipxpbx.conf.dir}"/>
    <copy file="etc/profilewriter.props.in.in" 
        tofile="${sipxpbx.conf.dir}/profilewriter.props.in" />
    <replace file="${sipxpbx.conf.dir}/profilewriter.props.in" 
        propertyfile="${top.build.dir}/config.properties">
      <replacefilter token="@profiledir@" property="profile.dir"/>
    </replace>

    <mkdir dir="${www.dir}/conf"/>
    <copy todir="${www.dir}/conf">
      <mapper type="glob" from="*.in" to="*" />
      <fileset dir="etc">
        <include name="httpd-sipxchange-configserver-pw.conf.in.in" />
        <include name="httpd-sipxchange-configserver-pw-ssl.conf.in.in" />
      </fileset>      
    </copy>

    <replace dir="${www.dir}/conf" 
        propertyfile="${top.build.dir}/config.properties">
      <include name="httpd-sipxchange-configserver-pw.conf.in"/>
      <include name="httpd-sipxchange-configserver-pw-ssl.conf.in"/>
      <replacefilter token="@profiledir@" property="profile.dir"/>
      <replacefilter token="@wwwdir@" property="www.dir"/>
    </replace>

  </target>

</project>


