<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<routes>
  <!-- routes may contain one or more route elements -->
  <route mappingType="local">
    <!-- 
     - A route may contain:
     -   multiple routeFrom elements, followed by a single methodMatch element.
     -   optionally followed by a single routeTo element.
     -
     - The host part of the target URI is compared with each routeFrom element until one matches.
     -   if none match, the routeTo element is used.
    -->
    <routeFrom>${SIPXCHANGE_DOMAIN_NAME}:${PROXY_SERVER_SIP_PORT}</routeFrom>
    <routeFrom>${MY_IP_ADDR}:${PROXY_SERVER_SIP_PORT}</routeFrom>
    <routeFrom>${MY_FULL_HOSTNAME}:${PROXY_SERVER_SIP_PORT}</routeFrom>
    <routeFrom>${MY_HOSTNAME}:${PROXY_SERVER_SIP_PORT}</routeFrom>
    <!-- 
      - Despite the name, the contents of a routeFrom specifies the destination of a URI 
      -->

    <methodMatch>
      <!--
       - If any one of the routeFrom element matched, then the methodMatch is evaluated
       - 
       - A methodMatch may contain zero or more fieldMatch elements, 
       - optionally followed by a single routeTo element.
       - Each methodPattern is eveluated; if any one matches, then the fieldMatch elements that
       - follow are evaluated.
       -->
      <methodPattern>SUBSCRIBE</methodPattern>

      <fieldMatch fieldName="Event">
        <!-- 
          - A fieldMatch may contain zero or more fieldPattern elements, 
          - followed by a single routeTo element.
          - Each fieldPattern is eveluated; if any one matches, then the routeTo is used
          -->
        <fieldPattern>message-summary.*</fieldPattern> <!-- Message waiting indication events -->
        <routeTo>&lt;${STATUS_SERVER_SIP_SRV_OR_HOSTPORT};transport=tcp&gt;</routeTo>
      </fieldMatch>

      <!-- If no fieldMatch matches, and there is a routeTo, then that routeTo is used -->
      <routeTo>&lt;${REGISTRAR_SERVER_SIP_SRV_OR_HOSTPORT}&gt;</routeTo>  
      <!-- All other SUBSCRIBE requests go to the SIP registry service -->

    </methodMatch>

    <!-- All other requests go to the SIP registry service -->
    <routeTo>&lt;${REGISTRAR_SERVER_SIP_SRV_OR_HOSTPORT}&gt;</routeTo>

  </route>
</routes>

