<?xml version="1.0" encoding="UTF-8" ?>

<!--
  - Phone core libs and GUI, See softphone for executable
  --> 
<project name="javacore" default="compile" basedir="."> 
  <property name="app.name" value="javacore" />

  <!--
    - T E S T S
    -->
  <patternset id="test.classes">
    <include name="AppClassLoaderTest.class"/>
  </patternset>

  <property name="top.build.dir" value="${basedir}/.."/>
  <property name="build.dir" value="${top.build.dir}/javacore"/>

  <import file="../ant-targets.xml"/>

  <property name="version.file" value="${classes.dir}/xpressa-version.properties"/>

<!-- Version Information From a file -->
<property file="buildVersion.properties" />

<!-- packages and lib information From a property file -->
<property file="build-wnt.properties" />

<property name="src.dir" value="src" />
<property name="dest.dir" value="lib" />

<property name="usage.message" value="ant deploy  -Dversion=&lt;version number&gt;  -Dbuild_number=&lt;build number&gt; -Dcomment=&lt;comment&gt; where comment is optional." /> 

<!-- compiles the source files -->
<target name="compile" depends="copymetadata">      
        <mkdir dir="${dest.dir}" />
        <echo message="----------------------------------" />
        <echo message="Compiling sipXphone source files" />
        <echo message="----------------------------------" />
        <javac debug="false" 
        	      deprecation="false" 
        	      destdir="${dest.dir}" 
        	      srcdir="${src.dir}" >

		<!--
                excludes=
                    "org\sipfoundry\telephony\test\*,
                     org\sipfoundry\util\tests\*,
                     org\sipfoundry\sipxphone\tests\*,
                     org\sipfoundry\sipxphone\hook\junit\*,
                     org\sipfoundry\sipxphone\app\preferences\junit\*,
                     org\sipfoundry\sipxphone\sys\tests\*,
                     org\sipfoundry\sipxphone\sys\jndi\tests\*,
                     org\sipfoundry\sipxphone\sys\directoryservice\ImportCsv.java,
                     org\sipfoundry\sipxphone\sys\user\PUser.java,
                     org\sipfoundry\sipxphone\sys\directoryservice\parser\*,
                     org\sipfoundry\sipxphone\sys\directoryservice\schemamap\*,
                     org\sipfoundry\siplite\tests\*" -->
               <!--bootclasspath="${jdk118.lib}" --> 
             <classpath>
                <pathelement location="${dest.dir}"  />
                <pathelement location="${jtapi.lib}" />
                <pathelement location="${ldap.lib}"  />
                <pathelement location="${jndi.lib}"  />
                <pathelement location="${junit.lib}" />
            </classpath>
       </javac>    
</target>


<!-- jarring up the classes -->
<target description="jars up the items" name="jar" depends="compile">
    <echo message="---------------------------------------------------" />
    <echo message="jarring up sipXphone classes and other required files" />
    <echo message="---------------------------------------------------" />
     <mkdir dir="${dest.dir}" />
    <jar basedir="${dest.dir}" compress="true" jarfile="${dest.dir}\..\${app.name}.jar" />

    <move file="${dest.dir}\..\${app.name}.jar" todir="${dest.dir}"/> 
</target>

<target description="just cleans the jar file" name="cleanjar">
    <delete file="${dest.dir}\${app.name}.jar" />	
</target>

<!-- cleans the compiled class files and jar file -->
 <target description="Clean all build products." name="clean">
     <echo message="----------------------------------------------" />
     <echo message="cleaning sipXphone class files and the jar file" />
     <echo message="-----------------------------------------------" />
     <mkdir dir="${dest.dir}" />
     <delete includeEmptyDirs="true">
         <fileset dir="${dest.dir}">
             <include name="org/sipfoundry/**/*"/>
             <include name="javax/**/*"/>
         </fileset>
    </delete>
    <delete file="${dest.dir}\${app.name}.jar"/>
</target>

<!-- creates the xpressa-version.properties file 
   if version and buildnum provided -->
<target name="createProperties" depends="checkVersionNumber, checkBuildNum">
    <mkdir dir="${dest.dir}" />
    <delete file="${dest.dir}\xpressa-version.properties"/>
    <propertyfile file="${dest.dir}\xpressa-version.properties" 
            comment="${app.name} build" >
        <entry  key="version"          value="${version}" />
        <entry  key="buildNumber"      value="${build_number}" />
        <entry  key="built"            value="now" 
                type="date"            pattern="MMM dd yyyy HH:mm:ss" />
        <entry  key="optionalComment"  value="" />        
  </propertyfile>
</target>


<!-- can't deploy if no version is provided -->
<target name="checkVersionNumber" unless="version" >
   <echo message="--------------ERROR: NO VERSION NUMBER WAS PROVIDED------" /> 
   <echo message="version number should be provided USAGE::"/>
   <echo message="${usage.message}"/>
   <fail message="version number should be provided"/> 
</target>

<!-- can't deploy if no buildnum is provided -->
<target name="checkBuildNum" unless="build_number">
   <echo message="--------------ERROR: NO  BUILD NUMBER WAS PROVIDED------" /> 
   <echo message="build number should be provided USAGE::"/>
   <echo message="${usage.message}"/>   
   <fail message="build number should be provided"/> 
</target>


<!-- deploy basically calls all the targets -->
<target name="deploy" depends="checkVersionNumber, checkBuildNum ,clean, compile, createProperties, jar" description="deploy basically calls all the targets, cleans the derived files, compiles all source files, creates properties file and jars them up.">
</target>

<target name="copymetadata">
    <echo message="Copying meta data for inclusion in final .jar" />
    <mkdir dir="${dest.dir}" />
    <copy todir="${dest.dir}">
        <fileset dir="meta/jar" />
    </copy>
</target>

</project>

