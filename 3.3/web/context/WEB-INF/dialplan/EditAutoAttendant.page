<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE page-specification PUBLIC "-//Apache Software Foundation//Tapestry Specification 4.0//EN" "http://jakarta.apache.org/tapestry/dtd/Tapestry_4_0.dtd">
<page-specification class="org.sipfoundry.sipxconfig.site.dialplan.EditAutoAttendant">
  <description>add a description</description>
  <!--
      - P R O P E R T I E S
      -->
  <property name="attendant"  persist="session"/>
  <inject property="vxmlGenerator" object="spring:vxml"/>
  <property name="currentDialPadId" />
  <property name="selections"  initial-value="new org.sipfoundry.sipxconfig.components.SelectMap()"/>
  <inject property="dialPlanContext" object="spring:dialPlanContext"/>
  <property name="currentDialPad" />
  <property name="addMenuItemDialPad" />
  <property name="addMenuItemAction" />
  <property name="callback"  persist="session"/>
  <!--
      - B E A N S
      -->
  <bean name="validator" class="org.sipfoundry.sipxconfig.components.SipxValidationDelegate"/>
  <bean name="nameValidator" class="org.apache.tapestry.valid.StringValidator" lifecycle="page">
    <set name="required" value="literal:true"/>
    <set name="minimumLength" value="literal:1"/>
  </bean>
  <bean name="extensionValidator" class="org.apache.tapestry.valid.NumberValidator" lifecycle="page">
    <set name="required" value="literal:false"/>
  </bean>
  <bean name="dialPadSelectionModel" class="org.sipfoundry.sipxconfig.components.EnumPropertySelectionModel">
    <set name="enumClass" value="literal:@org.sipfoundry.sipxconfig.common.DialPad@class"/>
  </bean>
  <bean name="menuItemActions" class="org.sipfoundry.sipxconfig.components.EnumPropertySelectionModel">
    <set name="enumClass" value="literal:@org.sipfoundry.sipxconfig.admin.dialplan.AttendantMenuAction@class"/>
  </bean>
  <bean name="localizedMenuItemActions" class="org.sipfoundry.sipxconfig.components.LocalizedOptionModelDecorator">
    <set name="model" value="literal:beans.menuItemActions"/>
    <set name="resourcePrefix" value="literal:'menuItemAction.'"/>
    <set name="messages" value="literal:messages"/>
  </bean>
  <bean name="autoAttendants" class="org.sipfoundry.sipxconfig.components.ObjectSelectionModel">
    <set name="collection" value="literal:dialPlanContext.autoAttendants"/>
    <set name="labelExpression" value="literal:'name'"/>
    <set name="valueExpression" value="literal:'systemName'"/>
  </bean>
  <bean name="menuItems" class="org.sipfoundry.sipxconfig.components.MutableKeyMapAdapter" lifecycle="render">
    <set name="map" value="literal:attendant.menuItems"/>
  </bean>
  <bean name="rowClass" class="org.apache.tapestry.bean.EvenOdd" lifecycle="render"/>
  <!--
      - C O M P O N E N T S
      -->
  <component id="form" type="Form">
    <binding name="delegate" value="bean:validator"/>
  </component>
  <component id="common" type="ItemCommon">
    <binding name="item" value="attendant"/>
    <binding name="useEnabled" value="false"/>
  </component>
  <!-- auto attendant prompts selection -->
  <component id="attendantPromptSelector" type="AssetSelectorPanel">
    <binding name="asset" value="attendant.prompt"/>
    <binding name="assetDir" value="vxmlGenerator.promptsDirectory"/>
    <binding name="errorMsg" value="message:error.select"/>
  </component>
  <component id="reset" type="Submit">
    <binding name="listener" value="listener:reset"/>
  </component>
  <component id="removeMenuItems" type="Submit">
    <binding name="listener" value="listener:removeMenuItems"/>
  </component>
  <component id="menuItemTableView" type="contrib:TableView">
    <binding name="source" value="bean:menuItems.entries"/>
    <binding name="columns">'* !Dialpad, ' + '!Action:, !Parameter:'</binding>
    <binding name="pageSize" value="literal:-1"/>
  </component>
  <component id="menuItemColumns" type="contrib:TableColumns">
  </component>
  <component id="menuItemRows" type="contrib:TableRows">
    <binding name="row" value="bean:menuItems.currentEntry"/>
    <binding name="class" value="bean:rowClass.next"/>
  </component>
  <component id="menuItemValues" type="contrib:TableValues"/>
  <!-- Column 1: select phone -->
  <component id="selectedRow" type="Checkbox">
    <binding name="value" value="selections.selected[beans.menuItems.key.name]"/>
  </component>
  <!-- Column 2: key dropdown -->
  <component id="DialpadColumnValue" type="Block"/>
  <component id="menuItemKey" type="PropertySelection">
    <binding name="model" value="bean:dialPadSelectionModel"/>
    <binding name="value" value="bean:menuItems.key"/>
  </component>
  <!-- Column 3: action dropdown -->
  <component id="ActionColumnValue" type="Block"/>
  <component id="menuItemAction" type="Insert">
    <binding name="value" value="messages.getMessage('menuItemAction.' + beans.menuItems.value.action.name, beans.menuItems.value.action.name)"/>
  </component>
  <!-- Column 4: optional action parameter -->
  <component id="ParameterColumnValue" type="Block"/>
  <component id="ifExtensionParameter" type="If">
    <binding name="condition" value="bean:menuItems.value.action.extensionParameter"/>
  </component>
  <component id="extensionParameter" type="TextField">
    <binding name="value" value="bean:menuItems.value.parameter"/>
  </component>
  <component id="ifAttendantParameter" type="If">
    <binding name="condition" value="bean:menuItems.value.action.attendantParameter"/>
  </component>
  <component id="attendantParameter" type="PropertySelection">
    <binding name="model" value="hivemind:spring:tapestry.instructUserToSelect(beans.autoAttendants)"/>
    <binding name="value" value="bean:menuItems.value.parameter"/>
  </component>
  <!-- Last Row : Add Menu Item -->
  <component id="addMenuItemRow" type="Any">
    <binding name="class" value="bean:rowClass.next"/>
  </component>
  <component id="addMenuItemKey" type="PropertySelection">
    <binding name="model" value="bean:dialPadSelectionModel"/>
    <binding name="value" value="addMenuItemDialPad"/>
  </component>
  <component id="addMenuItemAction" type="PropertySelection">
    <binding name="model" value="hivemind:spring:tapestry.instructUserToSelect(beans.localizedMenuItemActions)"/>
    <binding name="value" value="addMenuItemAction"/>
  </component>
  <component id="addMenuItem" type="Submit">
    <binding name="listener" value="listener:addMenuItem"/>
  </component>
  <component id="formActions" type="FormActions">
    <binding name="callback" value="callback"/>
    <binding name="listener" value="listener:commit"/>
  </component>
</page-specification>